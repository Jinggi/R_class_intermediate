library(dplyr)
library(ggplot2)

library(readxl)
df <- read_excel("office_data.xlsx")

head(df)
str(df)
summary(df)

### ?????? ?????? ??Á¤

# ?? ?????? ?????? ??Á¤ (H0: ?????Ì´?)

(tb <- xtabs(~region+year, data=df)[c("CBD", "GBD", "YBD", "ETC"),])

chisq.test(tb)
chisq.test(tb, simulate.p.value=T)   #Ç¥??Å©?? ??À» ???? ????Ä«???? ?Ã¹Ä·??Ì¼?

fisher.test(tb, conf.level=.95, alternative=c("two.sided"))
fisher.test(tb, conf.level=.95, alternative=c("two.sided"), simulate.p.value=T)



### ?????? ?????? ??Á¤

# ?? ??????, ?????? ??Á¤

t.test(price, mu=15000000, conf.level=.95, alternative=c("two.sided"))
t.test(price, mu=15000000, conf.level=.95, alternative=c("less"))
t.test(price, mu=15000000, conf.level=.95, alternative=c("greater"))

# ?? ??????, ?????? ???? ??Á¤

df <- df %>% mutate(size=ifelse(gfa>=15000, "big", "small"))

var.test(price~size, ratio=1, conf.level=.95, alternative=c("two.sided"))   #???Ð»? ??Á¤
t.test(price~size, var.equal=T, conf.level=.95, alternative=c("two.sided"))
t.test(price~size, var.equal=F, conf.level=.95, alternative=c("two.sided"))

v1 <- price[size=="big"]
v2 <- price[size=="small"]

var.test(v1, v2, ratio=1, conf.level=.95, alternative=c("two.sided"))
t.test(v1, v2, var.equal=T, conf.level=.95, alternative=c("two.sided"))
t.test(v1, v2, var.equal=F, conf.level=.95, alternative=c("two.sided"))

t.test(v1, v2, paired=T, conf.level=.95, alternative=c("two.sided"))  #?Ö´?????
t.test(v~f, paired=T, conf.level=.95, alternative=c("two.sided"))

# ?? ??????, ????À² ??Á¤
# n?? ???à¿¡?? x?? ?????Ç¾?À» ??, ?ß»?È®??À» p???? ?? ?? ?Ö´Â°??

prop.test(x=1000, n=10000, p=.15, conf.level=.95, alternative=c("two.sided"))
binom.test(x=1000, n=10000, p=.15, conf.level=.95, alternative=c("two.sided"))

# ?? ??????, ????À² ???? ??Á¤

prop.test(x=c(1000, 500), n=c(10000, 800), conf.level=.95, alternative=c("two.sided"))

# ?? ??????, ???Ð»? ???? ??Á¤

var.test(v1, v2)   #F??Á¤



### Á¤?Ô¼? ??Á¤

shapiro.test(price)
shapiro.test(log(price))   #Á¤?Ôº??? ???? ?Ê´? ???? ?Î±×º?È¯

ggplot(df, aes(sample=price)) +   #??À§??-??À§?? ?×·??? ?Û¼?
  geom_qq() +
  geom_qq_line()

df %>% 
  mutate(lnp=log(price)) %>%   #Á¤?Ôº??? ???? ?Ê´? ???? ?Î±×º?È¯
  ggplot(aes(sample=lnp)) +
    geom_qq() +
    geom_qq_line()



### ?????? ??Á¤

#?? ?????? ?ß½É¿? ???? ?????? ??Á¤

wilcox.test(price, mu=15000000, conf.level=.95, conf.int=T, alternative=c("two.sided"))

#?? ?????? ?ß½? ???Ì¿? ???? ?????? ??Á¤

wilcox.test(price~size, mu=0, conf.level=.95, conf.int=T, alternative=c("two.sided"))
wilcox.test(v1, v2, mu=0, conf.level=.95, conf.int=T, alternative=c("two.sided"))

ks.test(v1, v2)
